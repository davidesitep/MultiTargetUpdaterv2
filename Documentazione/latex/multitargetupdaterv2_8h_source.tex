\doxysection{multitargetupdaterv2.\+h}
\hypertarget{multitargetupdaterv2_8h_source}{}\label{multitargetupdaterv2_8h_source}\index{C:/Users/davided/source/repos/MultiTargetUpdaterv2/MultiTargetUpdaterv2/multitargetupdaterv2.h@{C:/Users/davided/source/repos/MultiTargetUpdaterv2/MultiTargetUpdaterv2/multitargetupdaterv2.h}}

\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00002\ }
\DoxyCodeLine{00003\ \textcolor{preprocessor}{\#include\ <QtWidgets/QMainWindow>}}
\DoxyCodeLine{00004\ \textcolor{preprocessor}{\#include\ <QString>}}
\DoxyCodeLine{00005\ \textcolor{preprocessor}{\#include\ <QProcess>}}
\DoxyCodeLine{00006\ \textcolor{preprocessor}{\#include\ <QTimer>}}
\DoxyCodeLine{00007\ \textcolor{preprocessor}{\#include\ <QRegularExpression>}\ \textcolor{comment}{//\ Replace\ QRegex\ with\ QRegularExpression}}
\DoxyCodeLine{00008\ \textcolor{preprocessor}{\#include\ "{}ui\_multitargetupdaterv2.h"{}}}
\DoxyCodeLine{00009\ \textcolor{preprocessor}{\#include\ "{}logger.h"{}}}
\DoxyCodeLine{00010\ \textcolor{preprocessor}{\#include\ <QFile>}}
\DoxyCodeLine{00011\ \textcolor{preprocessor}{\#include\ <QTextStream>}}
\DoxyCodeLine{00012\ \textcolor{preprocessor}{\#include\ <QThread>}}
\DoxyCodeLine{00013\ \textcolor{preprocessor}{\#include\ <QDebug>}}
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ <QDir>}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ <qfiledialog.h>}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ <qfileinfo.h>}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ <qcryptographichash.h>}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ <qxmlstream.h>}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ <openssl/evp.h>}}
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ <openssl/err.h>}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ <openssl/aes.h>}}
\DoxyCodeLine{00022\ }
\DoxyCodeLine{00023\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ VERSION\_SIZE\ =\ 64;}
\DoxyCodeLine{00024\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ DATA\_SIZE\ =\ 16;}
\DoxyCodeLine{00025\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ ORA\_SIZE\ =\ 16;}
\DoxyCodeLine{00026\ }
\DoxyCodeLine{00039\ }
\DoxyCodeLine{00040\ \textcolor{keyword}{class\ }MultiTargetUpdaterv2\ :\ \textcolor{keyword}{public}\ QMainWindow}
\DoxyCodeLine{00041\ \{}
\DoxyCodeLine{00042\ \ \ \ \ Q\_OBJECT}
\DoxyCodeLine{00043\ }
\DoxyCodeLine{00044\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00045\ \ \ \ \ MultiTargetUpdaterv2(QWidget*\ parent\ =\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00046\ \ \ \ \ \string~MultiTargetUpdaterv2();}
\DoxyCodeLine{00047\ }
\DoxyCodeLine{00048\ }
\DoxyCodeLine{00049\ }
\DoxyCodeLine{00050\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00051\ \ \ \ \ Ui::MultiTargetUpdaterv2Class\ ui;}
\DoxyCodeLine{00052\ \ \ \ \ \mbox{\hyperlink{classlogger}{logger}}*\ log;}
\DoxyCodeLine{00053\ \ \ \ \ \textcolor{keywordtype}{bool}\ isConnected\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00054\ \ \ \ \ \textcolor{keywordtype}{bool}\ enteringBl\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00055\ \ \ \ \ \textcolor{keywordtype}{bool}\ ready\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00056\ \ \ \ \ \textcolor{keywordtype}{bool}\ updateProcess\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00057\ \ \ \ \ QString\ mainLogDirPath\ =\ QDir::toNativeSeparators(QCoreApplication::applicationDirPath()\ +\ \textcolor{stringliteral}{"{}/log/"{}});}
\DoxyCodeLine{00058\ \ \ \ \ QTimer*\ enterBlTimer;}
\DoxyCodeLine{00059\ \ \ \ \ QTimer*\ netconfTransfTimer;}
\DoxyCodeLine{00060\ \ \ \ \ QTimer*\ downloadInstalledFwTimer;}
\DoxyCodeLine{00061\ \ \ \ \ \textcolor{keywordtype}{int}\ retryCount;}
\DoxyCodeLine{00062\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ MAX\_RETRIES\ =\ 9;}
\DoxyCodeLine{00063\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ RETRY\_INTERVAL\_MS\ =\ 1200;\ \textcolor{comment}{//\ 1\ secondo}}
\DoxyCodeLine{00064\ \ \ \ \ \textcolor{keyword}{const}\ QString\ hostName\ =\ \textcolor{stringliteral}{"{}192.168.1.80"{}};\ \textcolor{comment}{//\ Indirizzo\ IP\ del\ dispositivo}}
\DoxyCodeLine{00065\ \ \ \ \ \textcolor{keyword}{const}\ QString\ userName\ =\ \textcolor{stringliteral}{"{}SitepAdministrator"{}};}
\DoxyCodeLine{00066\ \ \ \ \ \textcolor{keyword}{const}\ QString\ password\ =\ \textcolor{stringliteral}{"{}SecureUpdate2015"{}};}
\DoxyCodeLine{00067\ \ \ \ \ \textcolor{keyword}{const}\ QString\ port\ =\ \textcolor{stringliteral}{"{}7356"{}};}
\DoxyCodeLine{00068\ }
\DoxyCodeLine{00069\ \ \ \ \ \textcolor{keyword}{const}\ QString\ updateHostName\ =\ \textcolor{stringliteral}{"{}192.168.1.19"{}};\ \textcolor{comment}{//\ Indirizzo\ IP\ del\ dispositivo}}
\DoxyCodeLine{00070\ \ \ \ \ \textcolor{keyword}{const}\ QString\ updateUserName\ =\ \textcolor{stringliteral}{"{}SitepUpdatePack"{}};}
\DoxyCodeLine{00071\ \ \ \ \ \textcolor{keyword}{const}\ QString\ updatePassword\ =\ \textcolor{stringliteral}{"{}SecureUpdate2016"{}};}
\DoxyCodeLine{00072\ \ \ \ \ \textcolor{keyword}{const}\ QString\ updatePort\ =\ \textcolor{stringliteral}{"{}21"{}};}
\DoxyCodeLine{00073\ \ \ \ \ \textcolor{keyword}{const}\ QString\ packType\ =\ \textcolor{stringliteral}{"{}*"{}};}
\DoxyCodeLine{00074\ }
\DoxyCodeLine{00075\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ rawKeyBytes[32]\ =\ \{\ 1,\ 253,\ 5,\ 60,\ 52,\ 91,\ 193,\ 133,\ 193,\ 121,\ 221,\ 164,\ 57,\ 128,\ 91,\ 91,\ 19,\ 39,\ 111,\ 197,\ 125,\ 98,\ 89,\ 48,\ 97,\ 154,\ 83,\ 187,\ 222,\ 167,\ 171,\ 74\ \};\ \textcolor{comment}{//\ La\ tua\ chiave\ AES\ (es.\ 16,\ 24\ o\ 32\ byte)}}
\DoxyCodeLine{00076\ }
\DoxyCodeLine{00077\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ rawIvBytes[16]\ =\ \{\ 10,\ 51,\ 235,\ 120,\ 122,\ 120,\ 80,\ 248,\ 13,\ 182,\ 196,\ 212,\ 176,\ 46,\ 23,\ 85\ \};\ \textcolor{comment}{//\ Il\ tuo\ IV\ (sempre\ 16\ byte\ per\ AES)}}
\DoxyCodeLine{00078\ }
\DoxyCodeLine{00079\ \ \ \ \ \textcolor{comment}{//\ Nuovo:\ Percorsi\ per\ il\ file\ da\ scaricare}}
\DoxyCodeLine{00080\ \ \ \ \ \textcolor{keyword}{const}\ QString\ remoteNetconfPath\ =\ \textcolor{stringliteral}{"{}/netconf.bin"{}};\ \textcolor{comment}{//\ Percorso\ remoto\ del\ file}}
\DoxyCodeLine{00081\ \ \ \ \ \textcolor{keyword}{const}\ QString\ localNetconfPath\ =\ \textcolor{stringliteral}{"{}netconf.bin"{}};\ \ \ \textcolor{comment}{//\ Nome\ del\ file\ locale}}
\DoxyCodeLine{00082\ \ \ \ \ QString\ listFilesLogPath;}
\DoxyCodeLine{00083\ \ \ \ \ \textcolor{keywordtype}{bool}\ listWidgetAlive;}
\DoxyCodeLine{00084\ }
\DoxyCodeLine{00085\ \textcolor{preprocessor}{\#pragma\ pack(push,\ 1)\ }\textcolor{comment}{//\ Assicura\ che\ la\ struttura\ non\ abbia\ padding\ tra\ i\ membri}}
\DoxyCodeLine{00086\ \ \ \ \ \textcolor{keyword}{struct\ }\mbox{\hyperlink{struct_multi_target_updaterv2_1_1_net_conf}{NetConf}}\ \{}
\DoxyCodeLine{00087\ \ \ \ \ \ \ \ \ uint32\_t\ Magic;}
\DoxyCodeLine{00088\ \ \ \ \ \ \ \ \ uint8\_t\ val\_IP\_ADDR[4];}
\DoxyCodeLine{00089\ \ \ \ \ \ \ \ \ uint8\_t\ val\_NETMASK\_ADDR[4];}
\DoxyCodeLine{00090\ \ \ \ \ \ \ \ \ uint8\_t\ val\_GW\_ADDR[4];}
\DoxyCodeLine{00091\ \ \ \ \ \ \ \ \ uint8\_t\ val\_MAC\_ADDR[6];}
\DoxyCodeLine{00092\ \ \ \ \ \ \ \ \ uint8\_t\ m2\_1;}
\DoxyCodeLine{00093\ \ \ \ \ \ \ \ \ uint8\_t\ m2\_2;}
\DoxyCodeLine{00094\ \ \ \ \ \ \ \ \ uint32\_t\ CRC;}
\DoxyCodeLine{00095\ \ \ \ \ \};}
\DoxyCodeLine{00096\ \textcolor{preprocessor}{\#pragma\ pack(pop)}}
\DoxyCodeLine{00097\ }
\DoxyCodeLine{00098\ \ \ \ \ \mbox{\hyperlink{struct_multi_target_updaterv2_1_1_net_conf}{NetConf}}\ Configurazione;}
\DoxyCodeLine{00099\ }
\DoxyCodeLine{00100\ \ \ \ \ \textcolor{keyword}{struct\ }\mbox{\hyperlink{struct_multi_target_updaterv2_1_1sw_info}{swInfo}}\ \{}
\DoxyCodeLine{00101\ \ \ \ \ \ \ \ \ QString\ version;}
\DoxyCodeLine{00102\ \ \ \ \ \ \ \ \ QString\ data;}
\DoxyCodeLine{00103\ \ \ \ \ \ \ \ \ QString\ ora;}
\DoxyCodeLine{00104\ \ \ \ \ \ \ \ \ QString\ deviceName;}
\DoxyCodeLine{00105\ \ \ \ \ \ \ \ \ QString\ fileLocation;}
\DoxyCodeLine{00106\ \ \ \ \ \};}
\DoxyCodeLine{00107\ \ \ \ \ QList<swInfo>\ installedFwInfos;}
\DoxyCodeLine{00108\ \ \ \ \ QList<swInfo>\ downloadedFwInfos;}
\DoxyCodeLine{00109\ }
\DoxyCodeLine{00110\ \ \ \ \ \textcolor{keyword}{struct\ }\mbox{\hyperlink{struct_multi_target_updaterv2_1_1remote_project}{remoteProject}}\ \{}
\DoxyCodeLine{00111\ \ \ \ \ \ \ \ \ QString\ updateHostName;}
\DoxyCodeLine{00112\ \ \ \ \ \ \ \ \ QString\ updateUserName;}
\DoxyCodeLine{00113\ \ \ \ \ \ \ \ \ QString\ updatePassword;}
\DoxyCodeLine{00114\ \ \ \ \ \ \ \ \ QString\ configurationName;}
\DoxyCodeLine{00115\ \ \ \ \ \ \ \ \ QString\ port;}
\DoxyCodeLine{00116\ \ \ \ \ \};}
\DoxyCodeLine{00117\ \ \ \ \ QList<remoteProject>\ remoteProjects;}
\DoxyCodeLine{00118\ }
\DoxyCodeLine{00119\ \ \ \ \ \textcolor{keyword}{struct\ }\mbox{\hyperlink{struct_multi_target_updaterv2_1_1device_fw_info}{deviceFwInfo}}\ \{}
\DoxyCodeLine{00120\ \ \ \ \ \ \ \ \ QString\ deviceName;}
\DoxyCodeLine{00121\ \ \ \ \ \ \ \ \ QString\ installedVersion;}
\DoxyCodeLine{00122\ \ \ \ \ \ \ \ \ QString\ installedData;}
\DoxyCodeLine{00123\ \ \ \ \ \ \ \ \ QString\ installedOra;}
\DoxyCodeLine{00124\ \ \ \ \ \ \ \ \ QString\ availableVersion;}
\DoxyCodeLine{00125\ \ \ \ \ \ \ \ \ QString\ availableData;}
\DoxyCodeLine{00126\ \ \ \ \ \ \ \ \ QString\ availableOra;}
\DoxyCodeLine{00127\ \ \ \ \ \ \ \ \ QString\ fileLocation;}
\DoxyCodeLine{00128\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ updated\ =\ \textcolor{keyword}{false};\ \textcolor{comment}{//\ Nuovo\ campo\ per\ tenere\ traccia\ dello\ stato\ di\ aggiornamento}}
\DoxyCodeLine{00129\ \ \ \ \ \};}
\DoxyCodeLine{00130\ \ \ \ \ QList<deviceFwInfo>\ deviceFwInfos;\ \textcolor{comment}{//\ Lista\ dei\ firmware\ installati\ sui\ dispositivi}}
\DoxyCodeLine{00131\ }
\DoxyCodeLine{00132\ }
\DoxyCodeLine{00133\ \ \ \ \ \textcolor{keywordtype}{void}\ enterBootloader();}
\DoxyCodeLine{00134\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{class_multi_target_updaterv2_a27de1d9d7c645160370227baffc0749e}{writeScriptFile}}(\textcolor{keyword}{const}\ QString\&\ script,\ \textcolor{keyword}{const}\ QString\&\ path);}
\DoxyCodeLine{00135\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_multi_target_updaterv2_a1cb5e684e89484c84b813840b4c3e863}{downLoadNetConfig}}();}
\DoxyCodeLine{00136\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_multi_target_updaterv2_a93bc4c2eb486041b7487c7fb4c10c665}{readNetConfig}}(\textcolor{keyword}{const}\ QString\&\ netConfPath);}
\DoxyCodeLine{00137\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_multi_target_updaterv2_a4b6d76186adc3d4acd2932025836e177}{checkInstalledfw}}();}
\DoxyCodeLine{00138\ \ \ \ \ \textcolor{keywordtype}{void}\ readFwVersions(\textcolor{keyword}{const}\ QString\&\ dataPath);}
\DoxyCodeLine{00139\ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{class_multi_target_updaterv2_aac3589ced94fa74413e8d39ce0c6bbd2}{readFwVersion}}(QString\ filePath,\ \mbox{\hyperlink{struct_multi_target_updaterv2_1_1sw_info}{swInfo}}\&\ info);}
\DoxyCodeLine{00140\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_multi_target_updaterv2_af7532a10e3f27b1300897fa2ccac4800}{updateFwTableWidget}}();}
\DoxyCodeLine{00141\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_multi_target_updaterv2_a0a0d353992faa0d81da0f4f40621a86e}{compareSwInfos}}(QList<swInfo>\&\ existingInfos,\ QList<swInfo>\ newInfos);}
\DoxyCodeLine{00142\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_multi_target_updaterv2_a5d91c95a94d9302b4c3f35f183e451c2}{downloadFwList}}();}
\DoxyCodeLine{00143\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_multi_target_updaterv2_a86ee61efabd5ee12bc7f96358544ac74}{readConfList}}(QString\ confListPath);}
\DoxyCodeLine{00144\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_multi_target_updaterv2_a5197c4367b18a877db8b0fd838d0c37a}{updateAvailableSystemList}}();}
\DoxyCodeLine{00145\ \ \ \ \ QString\ \mbox{\hyperlink{class_multi_target_updaterv2_aadd7c8ed2d48a0a7e32827e7a40fcc57}{DecryptString}}(\textcolor{keyword}{const}\ QString\&\ src);}
\DoxyCodeLine{00146\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_multi_target_updaterv2_aec1dcfb340aaf5f3bc77698fd4cd49b2}{handleOpenSSLError}}(\textcolor{keyword}{const}\ QString\&\ context);}
\DoxyCodeLine{00147\ \ \ \ \ \textcolor{keywordtype}{void}\ downloadRemoteFw();}
\DoxyCodeLine{00148\ \ \ \ \ QString\ hash\_generator(QString\ algorithm,\ QString\ filepath);}
\DoxyCodeLine{00149\ \ \ \ \ \textcolor{keywordtype}{void}\ unzipFolder(QString\ localTempFolder);}
\DoxyCodeLine{00150\ \ \ \ \ \textcolor{keywordtype}{void}\ readLocalFwVersion(\textcolor{keyword}{const}\ QString\&\ filesPath);}
\DoxyCodeLine{00151\ \ \ \ \ \textcolor{keywordtype}{void}\ updateFirmware(QString\ deviceName,\ QString\ path);}
\DoxyCodeLine{00152\ \ \ \ \ \textcolor{keywordtype}{void}\ checkUpdate(QString\ updateFileName,\ QString\ binFolder);}
\DoxyCodeLine{00153\ \ \ \ \ \textcolor{keywordtype}{void}\ cleanLogsView();}
\DoxyCodeLine{00154\ }
\DoxyCodeLine{00155\ signals:}
\DoxyCodeLine{00156\ \ \ \ \ \textcolor{keywordtype}{void}\ enableActionButton(QString\ deviceName);}
\DoxyCodeLine{00157\ \ \ \ \ \textcolor{keywordtype}{void}\ exportlog\_signal(\textcolor{keyword}{const}\ QString\ destinationDriPath);}
\DoxyCodeLine{00158\ }
\DoxyCodeLine{00159\ }
\DoxyCodeLine{00160\ \textcolor{keyword}{private}\ slots:}
\DoxyCodeLine{00161\ \ \ \ \ \textcolor{keywordtype}{void}\ on\_pushButtonClicked\_enterBlMode();}
\DoxyCodeLine{00162\ \ \ \ \ \textcolor{keywordtype}{void}\ onWinSCPErrorOccurred(QProcess::ProcessError\ error);}
\DoxyCodeLine{00163\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_multi_target_updaterv2_a59da0f41c0d483bbcabd52e33c1e5a6b}{retryWinSCPProcess}}();\ \textcolor{comment}{//\ Slot\ per\ il\ timer\ di\ ritentativo}}
\DoxyCodeLine{00164\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_multi_target_updaterv2_a7fd523b5c6ae02b13cba0785e044227e}{on\_pushButtonclicked\_checkInstalledFw}}();}
\DoxyCodeLine{00165\ \ \ \ \ \textcolor{keywordtype}{void}\ on\_pushButtonClicked\_downloadSystemList();}
\DoxyCodeLine{00166\ \ \ \ \ \textcolor{keywordtype}{void}\ on\_pushButtonClicked\_downloadFwforCurrentSystem();}
\DoxyCodeLine{00167\ \ \ \ \ \textcolor{keywordtype}{void}\ on\_pushButtonClicked\_loadFromLocalFolder();}
\DoxyCodeLine{00168\ \ \ \ \ \textcolor{keywordtype}{void}\ on\_pushButtonClicked\_startApplication();}
\DoxyCodeLine{00169\ \ \ \ \ \textcolor{keywordtype}{void}\ on\_pushButtonClicked\_exportLog();}
\DoxyCodeLine{00170\ \ \ \ \ \textcolor{keywordtype}{void}\ printLogMessage(\textcolor{keyword}{const}\ QString\&\ message);}
\DoxyCodeLine{00171\ }
\DoxyCodeLine{00172\ \};}
\DoxyCodeLine{00173\ }

\end{DoxyCode}
